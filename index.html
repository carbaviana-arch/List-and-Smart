<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lista de Compras Vintage</title>
<style>
    body {
        font-family: 'Georgia', serif;
        background-color: #f5f0e6;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        height: 100vh;
        color: #4b3832;
    }

    header {
        background-color: #c19a6b;
        color: #fff;
        padding: 15px;
        text-align: center;
        font-size: 1.5em;
        font-weight: bold;
        box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    }

    .content {
        flex: 1;
        overflow-y: auto;
        padding: 10px 15px;
        box-sizing: border-box;
    }

    .agregar-form {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 15px;
        background: #fff8f0;
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #d9c6b0;
    }

    .agregar-form input, .agregar-form select, .agregar-form button {
        font-family: 'Georgia', serif;
        font-size: 1em;
        padding: 8px 10px;
        border-radius: 4px;
        border: 1px solid #d9c6b0;
        color: #4b3832;
    }

    .agregar-form input, .agregar-form select {
        flex: 1 1 150px;
        min-width: 120px;
    }

    .agregar-form button {
        flex: 0 0 100px;
        background-color: #c19a6b;
        color: white;
        cursor: pointer;
        border: none;
        font-weight: bold;
        transition: background-color 0.3s;
    }

    .agregar-form button:hover {
        background-color: #a67c52;
    }

    .item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px;
        border-bottom: 1px solid #d9c6b0;
        background-color: #fff8f0;
        border-radius: 5px;
        margin-bottom: 5px;
        transition: opacity 0.3s;
    }

    .item.comprado {
        opacity: 0.5;
        background-color: #e0d6cb;
    }

    .item-caro {
        background-color: #f8e1c4;
        border: 1px solid #d4a373;
    }

    .nombre {
        flex: 2;
        cursor: pointer;
        user-select: none;
    }

    .cantidad-control {
        display: flex;
        align-items: center;
        gap: 5px;
        flex-wrap: nowrap;
        white-space: nowrap;
    }

    button.cantidad-btn {
        border: none;
        background-color: #c19a6b;
        color: #fff;
        padding: 5px 8px;
        font-size: 1em;
        border-radius: 4px;
        cursor: pointer;
        user-select: none;
        transition: background-color 0.3s;
    }

    button.cantidad-btn:hover {
        background-color: #a67c52;
    }

    .precio {
        margin-left: 5px;
        font-weight: bold;
        user-select: none;
    }

    .subtotal {
        margin-left: 10px;
        font-weight: bold;
        color: #5a3e36;
        user-select: none;
    }

    .delete-btn {
        background-color: transparent;
        color: red;
        font-size: 1.2em;
        cursor: pointer;
        user-select: none;
        border: none;
        padding: 0 6px;
    }

    .dock {
        display: flex;
        justify-content: space-around;
        background-color: #c19a6b;
        padding: 8px 0;
        border-top: 2px solid #a67c52;
        user-select: none;
    }

    .dock button {
        background: none;
        border: none;
        color: white;
        font-size: 1.4em;
        padding: 4px;
        cursor: pointer;
        transition: transform 0.1s ease;
    }

    .dock button:active {
        transform: scale(0.9);
    }

    .hidden {
        display: none;
    }

    .resumen {
        padding: 10px;
        background-color: #fff8f0;
        border-radius: 5px;
        border: 1px solid #d9c6b0;
        font-family: 'Georgia', serif;
        color: #4b3832;
    }

    #presupuestoTab input {
        width: 100%;
        box-sizing: border-box;
        font-family: 'Georgia', serif;
        font-size: 1em;
        padding: 8px 10px;
        border-radius: 4px;
        border: 1px solid #d9c6b0;
        color: #4b3832;
        margin-top: 8px;
    }

    #estadoPresupuesto {
        margin-top: 12px;
        font-weight: bold;
        user-select: none;
    }
</style>
</head>
<body>

<header>üõí Lista de Compras Vintage</header>

<div class="content" id="listaTab">
    <form class="agregar-form" id="formAgregar" onsubmit="return false;">
        <input type="text" id="inputNombre" placeholder="Producto" aria-label="Nombre del producto" required />
        <select id="inputCategoria" aria-label="Categor√≠a (opcional)">
            <option value="">-- Categor√≠a (opcional) --</option>
            <option value="Frutas">Frutas</option>
            <option value="Verduras">Verduras</option>
            <option value="L√°cteos">L√°cteos</option>
            <option value="Carnes">Carnes</option>
            <option value="Bebidas">Bebidas</option>
            <option value="Despensa">Despensa</option>
            <option value="Otros">Otros</option>
        </select>
        <input type="number" id="inputPrecio" placeholder="Precio (‚Ç¨)" min="0" step="0.01" aria-label="Precio del producto" required />
        <button type="submit" aria-label="A√±adir producto">A√±adir</button>
    </form>
    <div id="lista"></div>
</div>

<div class="content hidden" id="resumenTab">
    <div class="resumen" id="resumen"></div>
</div>

<div class="content hidden" id="presupuestoTab">
    <div class="resumen">
        <label for="presupuesto">Presupuesto (‚Ç¨): </label>
        <input type="number" id="presupuesto" min="0" step="0.01" aria-label="Presupuesto disponible" />
        <p id="estadoPresupuesto" aria-live="polite"></p>
    </div>
</div>

<div class="dock" role="tablist" aria-label="Navegaci√≥n de pesta√±as">
    <button onclick="mostrarTab('listaTab')" role="tab" aria-selected="true" aria-controls="listaTab" tabindex="0" title="Lista de compras">üìã</button>
    <button onclick="mostrarTab('resumenTab')" role="tab" aria-selected="false" aria-controls="resumenTab" tabindex="-1" title="Resumen por categor√≠a">üìä</button>
    <button onclick="mostrarTab('presupuestoTab')" role="tab" aria-selected="false" aria-controls="presupuestoTab" tabindex="-1" title="Presupuesto">üí∞</button>
</div>

<script>
    // Carga datos iniciales o vac√≠o
    let listaCompras = JSON.parse(localStorage.getItem('listaCompras')) || [];
    let presupuesto = parseFloat(localStorage.getItem('presupuesto')) || 0;

    // DOM referencias
    const listaDiv = document.getElementById("lista");
    const resumenDiv = document.getElementById("resumen");
    const presupuestoInput = document.getElementById("presupuesto");
    const estadoPresupuesto = document.getElementById("estadoPresupuesto");

    const btnsDock = document.querySelectorAll(".dock button");
    const tabs = {
        listaTab: document.getElementById("listaTab"),
        resumenTab: document.getElementById("resumenTab"),
        presupuestoTab: document.getElementById("presupuestoTab")
    };

    // Renderizar lista de compras
    function renderLista() {
        listaDiv.innerHTML = "";

        // Orden: no comprados primero, luego comprados
        const activos = listaCompras.filter(i => !i.comprado);
        const comprados = listaCompras.filter(i => i.comprado);
        [...activos, ...comprados].forEach((item, index) => {
            const subtotal = (item.precio * item.cantidad).toFixed(2);

            const itemDiv = document.createElement("div");
            itemDiv.className = "item";
            if (item.comprado) itemDiv.classList.add("comprado");
            if (subtotal >= 5) itemDiv.classList.add("item-caro");

            itemDiv.innerHTML = `
                <div class="nombre" onclick="toggleComprado(${index})" tabindex="0" role="button" aria-pressed="${item.comprado}" aria-label="Marcar ${item.nombre} como comprado o no">${item.nombre} ${item.precio.toFixed(2)}‚Ç¨</div>
                <div class="cantidad-control">
                    <button class="cantidad-btn" aria-label="Disminuir cantidad de ${item.nombre}" onclick="cambiarCantidad(${index}, -1)">-</button>
                    <span aria-live="polite" aria-atomic="true">${item.cantidad}</span>
                    <button class="cantidad-btn" aria-label="Aumentar cantidad de ${item.nombre}" onclick="cambiarCantidad(${index}, 1)">+</button>
                    <span class="subtotal">${subtotal}‚Ç¨</span>
                    <button class="delete-btn" aria-label="Eliminar ${item.nombre}" onclick="eliminarItem(${index})">üóëÔ∏è</button>
                </div>
            `;

            listaDiv.appendChild(itemDiv);
        });

        guardarDatos();
    }

    // Cambiar cantidad
    function cambiarCantidad(index, cambio) {
        listaCompras[index].cantidad += cambio;
        if (listaCompras[index].cantidad < 1) listaCompras[index].cantidad = 1;
        renderLista();
        renderResumen();
        actualizarEstadoPresupuesto();
    }

    // Marcar como comprado/no comprado
    function toggleComprado(index) {
        listaCompras[index].comprado = !listaCompras[index].comprado;
        renderLista();
    }

    // Eliminar item
    function eliminarItem(index) {
        listaCompras.splice(index, 1);
        renderLista();
        renderResumen();
        actualizarEstadoPresupuesto();
    }

    // Renderizar resumen por categor√≠a
    function renderResumen() {
        resumenDiv.innerHTML = "";
        const resumen = {};

        listaCompras.forEach(item => {
            const cat = item.categoria || 'Sin asignar';
            resumen[cat] = (resumen[cat] || 0) + item.precio * item.cantidad;
        });

        for (const cat in resumen) {
            const p = document.createElement("p");
            p.textContent = `${cat}: ${resumen[cat].toFixed(2)}‚Ç¨`;
            resumenDiv.appendChild(p);
        }
    }

    // Mostrar pesta√±a y actualizar aria-selected y tabindex
    function mostrarTab(id) {
        for (const tabId in tabs) {
            tabs[tabId].classList.toggle("hidden", tabId !== id);
        }
        btnsDock.forEach(btn => {
            const selected = btn.getAttribute("aria-controls") === id;
            btn.setAttribute("aria-selected", selected);
            btn.tabIndex = selected ? 0 : -1;
        });
        // Actualizamos contenido si necesario
        if (id === "resumenTab") renderResumen();
        if (id === "presupuestoTab") actualizarEstadoPresupuesto();
    }

    // Actualizar estado del presupuesto
    function actualizarEstadoPresupuesto() {
        if (presupuesto > 0) {
            const total = listaCompras.reduce((sum, item) => sum + item.precio * item.cantidad, 0);
            if (total > presupuesto) {
                estadoPresupuesto.textContent = `‚ö†Ô∏è Te has pasado del presupuesto por ${(total - presupuesto).toFixed(2)}‚Ç¨`;
                estadoPresupuesto.style.color = "red";
            } else {
                estadoPresupuesto.textContent = `‚úÖ Dentro del presupuesto. Te quedan ${(presupuesto - total).toFixed(2)}‚Ç¨`;
                estadoPresupuesto.style.color = "green";
            }
        } else {
            estadoPresupuesto.textContent = "";
        }
    }

    // Guardar datos en localStorage
    function guardarDatos() {
        localStorage.setItem('listaCompras', JSON.stringify(listaCompras));
        localStorage.setItem('presupuesto', presupuesto.toString());
    }

    // A√±adir nuevo producto desde el formulario
    document.getElementById("formAgregar").addEventListener("submit", e => {
        e.preventDefault();

        const nombre = document.getElementById("inputNombre").value.trim();
        const categoria = document.getElementById("inputCategoria").value;
        const precioStr = document.getElementById("inputPrecio").value.trim();
        const precio = parseFloat(precioStr);

        if (!nombre) {
            alert("Por favor escribe el nombre del producto.");
            return;
        }
        if (isNaN(precio) || precio < 0) {
            alert("Introduce un precio v√°lido.");
            return;
        }

        listaCompras.push({nombre, categoria, precio, cantidad: 1, comprado: false});
        document.getElementById("formAgregar").reset();
        renderLista();
        renderResumen();
        actualizarEstadoPresupuesto();
    });

    // Actualizar presupuesto al cambiar input
    presupuestoInput.value = presupuesto || "";
    presupuestoInput.addEventListener("input", e => {
        presupuesto = parseFloat(e.target.value) || 0;
        guardarDatos();
        actualizarEstadoPresupuesto();
    });

    // Inicializar vista
    mostrarTab("listaTab");
    renderLista();
    renderResumen();
    actualizarEstadoPresupuesto();
</script>

</body>
</html>