<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Le Cellier</title>
<style>
  /* Fuente elegante con sabor vintage franc√©s */
  @import url('https://fonts.googleapis.com/css2?family=Parisienne&family=Playfair+Display:wght@400;700&display=swap');

  body {
    font-family: 'Playfair Display', serif;
    background: #f7f3ee;
    color: #4a3c31;
    margin: 0;
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow: hidden;
  }

  header {
    background-color: #b49773;
    color: #f4eee1;
    font-family: 'Parisienne', cursive;
    font-size: 2.5rem;
    font-weight: 400;
    text-align: center;
    padding: 18px 0;
    letter-spacing: 3px;
    box-shadow: 0 4px 8px rgb(180 140 90 / 0.4);
    user-select: none;
  }

  .content {
    flex: 1;
    overflow-y: auto;
    padding: 15px 20px 80px; /* espacio para dock y contador */
    box-sizing: border-box;
    position: relative;
  }

  /* Formulario agregar producto */
  .agregar-form {
    background: #f2ede7;
    border: 2px solid #c7b79e;
    border-radius: 10px;
    padding: 12px 15px;
    margin-bottom: 15px;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
    font-size: 1rem;
  }

  .agregar-form input,
  .agregar-form select,
  .agregar-form button {
    font-family: 'Playfair Display', serif;
    font-size: 1rem;
    border-radius: 6px;
    border: 1.5px solid #a88e6e;
    padding: 8px 12px;
    color: #4a3c31;
    background: #faf6f0;
    transition: border-color 0.3s ease;
  }
  .agregar-form input:focus,
  .agregar-form select:focus {
    outline: none;
    border-color: #8c754b;
  }
  .agregar-form input[type=number] {
    max-width: 120px;
  }
  .agregar-form select {
    min-width: 180px;
  }
  .agregar-form button {
    background-color: #b49773;
    border: none;
    color: #f4eee1;
    cursor: pointer;
    font-weight: 600;
    transition: background-color 0.3s ease;
    min-width: 110px;
  }
  .agregar-form button:hover {
    background-color: #9d7f53;
  }

  /* Lista items */
  #lista {
    margin: 0;
  }

  .item {
    background: #f8f4ec;
    border: 1.5px solid #c7b79e;
    border-radius: 8px;
    margin-bottom: 10px;
    padding: 10px 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: 500;
    color: #4a3c31;
    transition: background-color 0.3s, opacity 0.3s;
    user-select: none;
  }
  .item.comprado {
    opacity: 0.5;
    background-color: #e3dccf;
    font-style: italic;
  }
  .item.item-caro {
    border-color: #a86e33;
    background-color: #f9ebd8;
    font-weight: 700;
  }

  .nombre {
    flex: 2;
    cursor: pointer;
  }

  .cantidad-control {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  button.cantidad-btn {
    background-color: #b49773;
    color: #f4eee1;
    border: none;
    border-radius: 6px;
    padding: 5px 10px;
    font-weight: 700;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.3s ease;
  }
  button.cantidad-btn:hover {
    background-color: #9d7f53;
  }

  .precio, .subtotal {
    font-weight: 700;
    min-width: 60px;
    text-align: right;
    user-select: none;
  }

  button.delete-btn {
    background: transparent;
    border: none;
    font-size: 1.2rem;
    color: #b94848;
    cursor: pointer;
    user-select: none;
    transition: color 0.3s ease;
  }
  button.delete-btn:hover {
    color: #7a2f2f;
  }

  /* Contador flotante presupuesto */
  #contadorPresupuesto {
    position: fixed;
    bottom: 70px;
    left: 50%;
    transform: translateX(-50%);
    background: #b49773cc;
    color: #f4eee1;
    font-family: 'Parisienne', cursive;
    font-size: 1.6rem;
    padding: 10px 20px;
    border-radius: 30px;
    box-shadow: 0 2px 8px rgb(180 140 90 / 0.8);
    user-select: none;
    z-index: 1500;
    min-width: 220px;
    text-align: center;
  }

  /* Tabs content */
  .hidden {
    display: none;
  }

  /* Resumen */
  .resumen {
    background: #f2ede7;
    border-radius: 10px;
    border: 2px solid #c7b79e;
    padding: 15px 20px;
    font-family: 'Playfair Display', serif;
    font-weight: 600;
    font-size: 1.1rem;
    color: #4a3c31;
  }

  .resumen p {
    margin: 8px 0;
  }

  /* Dock */
  .dock {
    position: fixed;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 100%;
    max-width: 480px;
    background: #b49773;
    border-top: 3px solid #9d7f53;
    display: flex;
    justify-content: space-around;
    padding: 12px 0;
    box-shadow: 0 -3px 15px rgb(157 127 83 / 0.9);
    user-select: none;
    z-index: 2000;
    border-radius: 15px 15px 0 0;
  }
  .dock button {
    background: none;
    border: none;
    color: #f4eee1;
    font-size: 1.7rem;
    cursor: pointer;
    transition: transform 0.2s ease, color 0.3s ease;
  }
  .dock button[aria-selected="true"] {
    transform: scale(1.2);
    color: #fff5d9;
  }
  .dock button:hover:not([aria-selected="true"]) {
    color: #d2c9b8;
    transform: scale(1.1);
  }

  /* Form input focus outline for accessibility */
  input:focus, select:focus, button:focus {
    outline: 2px solid #9d7f53;
    outline-offset: 2px;
  }

</style>
</head>
<body>

<header>Le Cellier</header>

<div class="content" id="listaTab">
  <form class="agregar-form" id="formAgregar" onsubmit="return false;">
    <input type="text" id="inputNombre" placeholder="Producto" aria-label="Nombre del producto" required />
    <select id="inputCategoria" aria-label="Categor√≠a (opcional)">
      <option value="">-- Categor√≠a (opcional) --</option>
      <option value="Frutas">Frutas</option>
      <option value="Verduras">Verduras</option>
      <option value="L√°cteos">L√°cteos</option>
      <option value="Carnes">Carnes</option>
      <option value="Bebidas">Bebidas</option>
      <option value="Despensa">Despensa</option>
      <option value="Higiene y Cuidado Personal">Higiene y Cuidado Personal</option>
      <option value="Lavander√≠a">Lavander√≠a</option>
      <option value="Limpieza">Limpieza</option>
      <option value="Congelados">Congelados</option>
      <option value="Fitness">Fitness</option>
      <option value="Otros">Otros</option>
    </select>
    <input type="number" id="inputPrecio" placeholder="Precio (‚Ç¨)" min="0" step="0.01" aria-label="Precio del producto" required />
    <button type="submit" aria-label="A√±adir producto">A√±adir</button>
  </form>
  <div id="lista" aria-live="polite"></div>
</div>

<div class="content hidden" id="resumenTab">
  <div class="resumen" aria-live="polite" aria-label="Resumen de gastos por categor√≠a" id="resumen"></div>
</div>

<div class="content hidden" id="presupuestoTab">
  <div class="resumen">
    <label for="presupuesto">Presupuesto (‚Ç¨): </label>
    <input type="number" id="presupuesto" min="0" step="0.01" aria-label="Presupuesto disponible" />
    <p id="estadoPresupuesto" aria-live="polite"></p>
  </div>
</div>

<div id="contadorPresupuesto" aria-live="polite" aria-atomic="true" role="status"></div>

<div class="dock" role="tablist" aria-label="Navegaci√≥n de pesta√±as">
  <button onclick="mostrarTab('listaTab')" role="tab" aria-selected="true" aria-controls="listaTab" tabindex="0" title="Lista de compras">üìã</button>
  <button onclick="mostrarTab('resumenTab')" role="tab" aria-selected="false" aria-controls="resumenTab" tabindex="-1" title="Resumen por categor√≠a">üìä</button>
  <button onclick="mostrarTab('presupuestoTab')" role="tab" aria-selected="false" aria-controls="presupuestoTab" tabindex="-1" title="Presupuesto">üí∞</button>
</div>

<script>
  // Datos en localStorage
  let listaCompras = JSON.parse(localStorage.getItem('listaCompras')) || [];
  let presupuesto = parseFloat(localStorage.getItem('presupuesto')) || 0;

  // Referencias DOM
  const listaDiv = document.getElementById("lista");
  const resumenDiv = document.getElementById("resumen");
  const presupuestoInput = document.getElementById("presupuesto");
  const estadoPresupuesto = document.getElementById("estadoPresupuesto");
  const contadorPresupuesto = document.getElementById("contadorPresupuesto");

  const btnsDock = document.querySelectorAll(".dock button");
  const tabs = {
    listaTab: document.getElementById("listaTab"),
    resumenTab: document.getElementById("resumenTab"),
    presupuestoTab: document.getElementById("presupuestoTab")
  };

  // Renderizar lista de compras
  function renderLista() {
    listaDiv.innerHTML = "";

    const activos = listaCompras.filter(i => !i.comprado);
    const comprados = listaCompras.filter(i => i.comprado);
    [...activos, ...comprados].forEach((item, index) => {
      const subtotal = (item.precio * item.cantidad).toFixed(2);

      const itemDiv = document.createElement("div");
      itemDiv.className = "item";
      if (item.comprado) itemDiv.classList.add("comprado");
      if (subtotal >= 5) itemDiv.classList.add("item-caro");

      itemDiv.innerHTML = `
        <div class="nombre" onclick="toggleComprado(${index})" tabindex="0" role="button" aria-pressed="${item.comprado}" aria-label="Marcar ${item.nombre} como comprado o no">${item.nombre} ${item.precio.toFixed(2)}‚Ç¨</div>
        <div class="cantidad-control" aria-label="Controles de cantidad y eliminaci√≥n">
          <button class="cantidad-btn" aria-label="Disminuir cantidad de ${item.nombre}" onclick="cambiarCantidad(${index}, -1)">-</button>
          <span aria-live="polite" aria-atomic="true">${item.cantidad}</span>
          <button class="cantidad-btn" aria-label="Aumentar cantidad de ${item.nombre}" onclick="cambiarCantidad(${index}, 1)">+</button>
          <span class="subtotal">${subtotal}‚Ç¨</span>
          <button class="delete-btn" aria-label="Eliminar ${item.nombre}" onclick="eliminarItem(${index})">üóëÔ∏è</button>
        </div>
      `;

      listaDiv.appendChild(itemDiv);
    });

    guardarDatos();
    actualizarContadorPresupuesto();
  }

  // Cambiar cantidad
  function cambiarCantidad(index, cambio) {
    listaCompras[index].cantidad += cambio;
    if (listaCompras[index].cantidad < 1) listaCompras[index].cantidad = 1;
    renderLista();
    renderResumen();
    actualizarEstadoPresupuesto();
  }

  // Marcar comprado
  function toggleComprado(index) {
    listaCompras[index].comprado = !listaCompras[index].comprado;
    renderLista();
  }

  // Eliminar item
  function eliminarItem(index) {
    listaCompras.splice(index, 1);
    renderLista();
    renderResumen();
    actualizarEstadoPresupuesto();
  }

  // Renderizar resumen por categor√≠a
  function renderResumen() {
    resumenDiv.innerHTML = "";
    const resumen = {};

    listaCompras.forEach(item => {
      const cat = item.categoria || 'Sin asignar';
      resumen[cat] = (resumen[cat] || 0) + item.precio * item.cantidad;
    });

    for (const cat in resumen) {
      const p = document.createElement("p");
      p.textContent = `${cat}: ${resumen[cat].toFixed(2)}‚Ç¨`;
      resumenDiv.appendChild(p);
    }
  }

  // Mostrar pesta√±a activa
  function mostrarTab(id) {
    for (const tabId in tabs) {
      tabs[tabId].classList.toggle("hidden", tabId !== id);
    }
    btnsDock.forEach(btn => {
      const selected = btn.getAttribute("aria-controls") === id;
      btn.setAttribute("aria-selected", selected);
      btn.tabIndex = selected ? 0 : -1;
    });

    if (id === "resumenTab") renderResumen();
    if (id === "presupuestoTab") actualizarEstadoPresupuesto();
  }

  // Actualizar presupuesto y mostrar aviso si se pasa
  function actualizarEstadoPresupuesto() {
    if (presupuesto > 0) {
      const total = listaCompras.reduce((sum, item) => sum + item.precio * item.cantidad, 0);
      if (total > presupuesto) {
        estadoPresupuesto.textContent = `‚ö†Ô∏è Te has pasado del presupuesto por ${(total - presupuesto).toFixed(2)}‚Ç¨`;
        estadoPresupuesto.style.color = "#b94848";
      } else {
        estadoPresupuesto.textContent = `‚úÖ Dentro del presupuesto. Te quedan ${(presupuesto - total).toFixed(2)}‚Ç¨`;
        estadoPresupuesto.style.color = "#4a703d";
      }
    } else {
      estadoPresupuesto.textContent = "";
    }
  }

  // Contador flotante presupuesto restante
  function actualizarContadorPresupuesto() {
    if (presupuesto > 0) {
      const totalComprado = listaCompras
        .filter(i => i.comprado)
        .reduce((sum, i) => sum + i.precio * i.cantidad, 0);
      const restante = presupuesto - totalComprado;
      contadorPresupuesto.textContent = `Presupuesto restante: ${restante.toFixed(2)}‚Ç¨`;
      contadorPresupuesto.style.color = restante < 0 ? "#b94848" : "#4a703d";
    } else {
      contadorPresupuesto.textContent = "Define un presupuesto para controlar tus gastos";
      contadorPresupuesto.style.color = "#6b5e4a";
    }
  }

  // Guardar datos
  function guardarDatos() {
    localStorage.setItem('listaCompras', JSON.stringify(listaCompras));
    localStorage.setItem('presupuesto', presupuesto.toString());
  }

  // A√±adir producto desde el formulario
  document.getElementById("formAgregar").addEventListener("submit", e => {
    e.preventDefault();

    const nombre = document.getElementById("inputNombre").value.trim();
    const categoria = document.getElementById("inputCategoria").value;
    const precioStr = document.getElementById("inputPrecio").value.trim();
    const precio = parseFloat(precioStr);

    if (!nombre) {
      alert("Por favor escribe el nombre del producto.");
      return;
    }
    if (isNaN(precio) || precio < 0) {
      alert("Introduce un precio v√°lido.");
      return;
    }

    listaCompras.push({ nombre, categoria, precio, cantidad: 1, comprado: false });
    document.getElementById("formAgregar").reset();
    renderLista();
    renderResumen();
    actualizarEstadoPresupuesto();
  });

  // Cambiar presupuesto
  presupuestoInput.value = presupuesto || "";
  presupuestoInput.addEventListener("input", e => {
    presupuesto = parseFloat(e.target.value) || 0;
    guardarDatos();
    actualizarEstadoPresupuesto();
    actualizarContadorPresupuesto();
  });

  // Inicializaci√≥n
  renderLista();
  renderResumen();
  actualizarEstadoPresupuesto();
  actualizarContadorPresupuesto();
</script>

</body>
</html>