import React, { useState } from "react";
import { FiList, FiPieChart, FiTrash2, FiDollarSign } from "react-icons/fi";

export default function App() {
  const [activeTab, setActiveTab] = useState("lista");
  const [items, setItems] = useState([
    { id: 1, nombre: "Patatas", precio: 3, cantidad: 2, categoria: "Verduras", comprado: false },
    { id: 2, nombre: "Pan", precio: 1.5, cantidad: 3, categoria: "Panadería", comprado: false },
    { id: 3, nombre: "Aceite", precio: 6, cantidad: 1, categoria: "Despensa", comprado: false }
  ]);
  const [presupuesto, setPresupuesto] = useState(50);

  const toggleComprado = (id) => {
    setItems((prev) =>
      prev.map((item) =>
        item.id === id ? { ...item, comprado: !item.comprado } : item
      ).sort((a, b) => a.comprado - b.comprado)
    );
  };

  const cambiarCantidad = (id, delta) => {
    setItems((prev) =>
      prev.map((item) =>
        item.id === id
          ? { ...item, cantidad: Math.max(1, item.cantidad + delta) }
          : item
      )
    );
  };

  const eliminarItem = (id) => {
    setItems((prev) => prev.filter((item) => item.id !== id));
  };

  const gastoTotal = items.reduce((acc, item) => acc + item.precio * item.cantidad, 0);

  const gastoPorCategoria = items.reduce((acc, item) => {
    const subtotal = item.precio * item.cantidad;
    acc[item.categoria] = (acc[item.categoria] || 0) + subtotal;
    return acc;
  }, {});

  return (
    <div className="flex flex-col h-screen bg-[#f5e8d8] font-serif">
      {/* Contenido */}
      <div className="flex-1 overflow-y-auto p-4">
        {activeTab === "lista" && (
          <div>
            {items.map((item) => (
              <div
                key={item.id}
                className={`flex justify-between items-center p-3 mb-2 rounded-lg shadow-md 
                  ${item.comprado ? "opacity-50 bg-[#e2d2b0]" : "bg-[#fff4e0]"} 
                  border border-[#b08d57]`}
              >
                <div
                  className="flex-1 cursor-pointer"
                  onClick={() => toggleComprado(item.id)}
                >
                  <span>{item.nombre} {item.precio.toFixed(2)}€</span>
                  <span className="mx-2">-</span>
                  <span
                    className="px-2 py-1 border border-[#b08d57] rounded cursor-pointer mx-1"
                    onClick={(e) => { e.stopPropagation(); cambiarCantidad(item.id, -1); }}
                  >-</span>
                  <span>{item.cantidad}</span>
                  <span
                    className="px-2 py-1 border border-[#b08d57] rounded cursor-pointer mx-1"
                    onClick={(e) => { e.stopPropagation(); cambiarCantidad(item.id, 1); }}
                  >+</span>
                  <span className="ml-2">{(item.precio * item.cantidad).toFixed(2)}€</span>
                </div>
                <button
                  className="text-red-600"
                  onClick={() => eliminarItem(item.id)}
                >
                  <FiTrash2 size={20} />
                </button>
              </div>
            ))}
          </div>
        )}

        {activeTab === "resumen" && (
          <div className="bg-[#fff4e0] p-4 rounded-lg shadow-md border border-[#b08d57]">
            <h2 className="text-lg font-bold mb-4">Gasto por categoría</h2>
            {Object.entries(gastoPorCategoria).map(([cat, total]) => (
              <div key={cat} className="flex justify-between border-b border-[#b08d57] py-2">
                <span>{cat}</span>
                <span>{total.toFixed(2)}€</span>
              </div>
            ))}
            <div className="mt-4 font-bold">Total: {gastoTotal.toFixed(2)}€</div>
          </div>
        )}

        {activeTab === "presupuesto" && (
          <div className="bg-[#fff4e0] p-4 rounded-lg shadow-md border border-[#b08d57]">
            <h2 className="text-lg font-bold mb-4">Presupuesto</h2>
            <div className="mb-2">
              <label className="block mb-1">Presupuesto total (€)</label>
              <input
                type="number"
                value={presupuesto}
                onChange={(e) => setPresupuesto(Number(e.target.value))}
                className="w-full p-2 border border-[#b08d57] rounded bg-[#f5e8d8]"
              />
            </div>
            <div className="mt-4">
              <div className="flex justify-between mb-1">
                <span>Gastado:</span>
                <span>{gastoTotal.toFixed(2)}€</span>
              </div>
              <div className="w-full bg-[#e2d2b0] rounded-full h-4">
                <div
                  className="bg-[#b08d57] h-4 rounded-full"
                  style={{ width: `${Math.min((gastoTotal / presupuesto) * 100, 100)}%` }}
                ></div>
              </div>
              <div className="mt-2">
                Restante: {(presupuesto - gastoTotal).toFixed(2)}€
              </div>
            </div>
          </div>
        )}
      </div>

      {/* Dock inferior */}
      <div className="flex justify-around bg-[#b08d57] text-white py-2 border-t border-[#8c6b3d]">
        <button onClick={() => setActiveTab("lista")} className="flex flex-col items-center">
          <FiList size={22} />
          <span className="text-xs">Lista</span>
        </button>
        <button onClick={() => setActiveTab("resumen")} className="flex flex-col items-center">
          <FiPieChart size={22} />
          <span className="text-xs">Resumen</span>
        </button>
        <button onClick={() => setActiveTab("presupuesto")} className="flex flex-col items-center">
          <FiDollarSign size={22} />
          <span className="text-xs">Presupuesto</span>
        </button>
      </div>
    </div>
  );
}